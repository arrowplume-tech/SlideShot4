# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º Playwright

## üéØ –ò—Ç–æ–≥
–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Å Playwright **—Ä–µ—à–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã**. –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ.

---

## üìã –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚ùå –ë—Ä–∞—É–∑–µ—Ä Firefox –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–ö–†–ò–¢–ò–ß–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü–æ—Å–ª–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å GitHub –≤—ã–ø–æ–ª–Ω—è–ª—Å—è —Ç–æ–ª—å–∫–æ `npm install`, –∫–æ—Ç–æ—Ä—ã–π —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Playwright –±–∏–±–ª–∏–æ—Ç–µ–∫—É, –Ω–æ –ù–ï —Å–∫–∞—á–∏–≤–∞–µ—Ç –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ –±–∏–Ω–∞—Ä–Ω–∏–∫–∏ Firefox.

**–û—à–∏–±–∫–∞ –≤ –ª–æ–≥–∞—Ö:**
```
browserType.launch: Executable doesn't exist at /home/runner/workspace/.cache/ms-playwright/firefox-1495/firefox/firefox
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
npx playwright install firefox
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û - Firefox 142.0.1 —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (96.7 MB)

---

### 2. ‚ùå –£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ - –±—Ä–∞—É–∑–µ—Ä –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–ª—Å—è (–ö–†–ò–¢–ò–ß–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í `server/routes.ts` —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –Ω–æ–≤—ã–π `ConversionPipeline`, –Ω–æ –º–µ—Ç–æ–¥ `pipeline.cleanup()` –ù–ò–ö–û–ì–î–ê –Ω–µ –≤—ã–∑—ã–≤–∞–ª—Å—è. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ —Ç–æ–º—É —á—Ç–æ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –æ—Å—Ç–∞–≤–∞–ª—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–π –ø—Ä–æ—Ü–µ—Å—Å Firefox –≤ —Ñ–æ–Ω–µ.

**–ö–æ–¥ –î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```typescript
app.post("/api/convert", async (req, res) => {
  try {
    const pipeline = new ConversionPipeline();
    const { buffer, logs } = await pipeline.convert(html, options);
    res.json({ success: true, ... });
  } catch (error) {
    res.status(500).json({ error: ... });
  }
  // ‚ùå pipeline.cleanup() –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è!
});
```

**–ö–æ–¥ –ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```typescript
app.post("/api/convert", async (req, res) => {
  const pipeline = new ConversionPipeline();
  try {
    const { buffer, logs } = await pipeline.convert(html, options);
    res.json({ success: true, ... });
  } catch (error) {
    res.status(500).json({ error: ... });
  } finally {
    await pipeline.cleanup(); // ‚úÖ –ë—Ä–∞—É–∑–µ—Ä –í–°–ï–ì–î–ê –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è
    console.log("[API] Pipeline cleanup completed");
  }
});
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è —É—Ç–µ—á–∫–∏:**
- –ö–∞–∂–¥–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –æ—Å—Ç–∞–≤–ª—è–ª–∞ –ø—Ä–æ—Ü–µ—Å—Å Firefox (~200-300 MB –ø–∞–º—è—Ç–∏)
- –ü–æ—Å–ª–µ 10-20 –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–π —Å–µ—Ä–≤–µ—Ä –º–æ–≥ —É–ø–∞—Å—Ç—å –∏–∑-–∑–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –ø–∞–º—è—Ç–∏
- –ü—Ä–æ—Ü–µ—Å—Å—ã –Ω–∞–∫–∞–ø–ª–∏–≤–∞–ª–∏—Å—å –ø–æ–∫–∞ —Å–µ—Ä–≤–µ—Ä –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–ª—Å—è

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û - –¥–æ–±–∞–≤–ª–µ–Ω `finally` –±–ª–æ–∫

---

### 3. ‚úÖ Timeout –Ω–∞ Google Fonts (–£–ñ–ï –ë–´–õ –ò–°–ü–†–ê–í–õ–ï–ù)

**–ü—Ä–æ–±–ª–µ–º–∞ (–±—ã–ª–∞ —Ä–∞–Ω–µ–µ):**
Playwright –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `waitUntil: "networkidle"`, –∫–æ—Ç–æ—Ä—ã–π –∂–¥–∞–ª –ø–æ–∫–∞ –≤—Å–µ —Å–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞–≤–µ—Ä—à–∞—Ç—Å—è. Google Fonts –≤ headless –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å, –∏ –±—Ä–∞—É–∑–µ—Ä –∑–∞–≤–∏—Å–∞–ª –Ω–∞ 30 —Å–µ–∫—É–Ω–¥.

**–†–µ—à–µ–Ω–∏–µ (—É–∂–µ –≤ –∫–æ–¥–µ):**
```typescript
// server/lib/playwright-layout-collector.ts, —Å—Ç—Ä–æ–∫–∞ 78-80
await page.setContent(fullHtml, { 
  waitUntil: "load",      // ‚úÖ –ù–µ "networkidle"
  timeout: 60000          // ‚úÖ 60 —Å–µ–∫—É–Ω–¥
});
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£–ñ–ï –ò–°–ü–†–ê–í–õ–ï–ù–û –≤ –∫–æ–¥–µ - –Ω–∏—á–µ–≥–æ –Ω–µ —Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å

---

## üîç –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

1. **Error handling** ‚úÖ
   - Playwright –æ—à–∏–±–∫–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è
   - Fallback –Ω–∞ JSDOM –µ—Å–ª–∏ Playwright –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
   - –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

2. **Resource cleanup** ‚úÖ (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
   - `page.close()` –≤ `finally` –±–ª–æ–∫–µ
   - `browser.close()` –≤ `pipeline.cleanup()`
   - –¢–µ–ø–µ—Ä—å cleanup –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ routes

3. **Timeout settings** ‚úÖ
   - `waitUntil: "load"` –≤–º–µ—Å—Ç–æ "networkidle"
   - 60 —Å–µ–∫—É–Ω–¥ timeout –¥–ª—è —Å–ª–æ–∂–Ω–æ–≥–æ HTML
   - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∑–∞–ø—É—Å–∫–∞ Firefox

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ):

1. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞**
   –°–µ–π—á–∞—Å –±—Ä–∞—É–∑–µ—Ä —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞. –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å singleton –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ, —Å–æ–∑–¥–∞–≤–∞—è —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –≠—Ç–æ —É—Å–∫–æ—Ä–∏—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é.

2. **Graceful shutdown**
   –ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ (SIGTERM/SIGINT) –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –≤—Å–µ—Ö –æ—Ç–∫—Ä—ã—Ç—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤.

---

## üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –±—É–¥—É—â–∏—Ö —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–π

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ `git clone`:

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# 2. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û! –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Playwright –±—Ä–∞—É–∑–µ—Ä—ã
npx playwright install firefox

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
npm run dev
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ Playwright —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ª—é–±–æ–π HTML
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   ```
   ‚úÖ Playwright: –ø–æ–ª—É—á–µ–Ω–æ N —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —Ç–æ—á–Ω—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏
   [API] Pipeline cleanup completed
   ```

–ï—Å–ª–∏ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –≤–∏–¥–∏—Ç–µ:
```
‚ö†Ô∏è Playwright –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è JSDOM –ø–∞—Ä—Å–µ—Ä
```
–ó–Ω–∞—á–∏—Ç –±—Ä–∞—É–∑–µ—Ä—ã –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã - –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `npx playwright install firefox`.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã:
- ‚úÖ Firefox –±—Ä–∞—É–∑–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- ‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Playwright
- ‚úÖ `pipeline.cleanup()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ –ë—Ä–∞—É–∑–µ—Ä –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤ –ª–æ–≥–∞—Ö)
- ‚úÖ –ù–µ—Ç —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è—Ö

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ü—Ä–æ–±–ª–µ–º–∞ | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –°—Ç–∞—Ç—É—Å | –ì–¥–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
|----------|-------------|--------|----------------|
| Firefox –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | CLI –∫–æ–º–∞–Ω–¥–∞ |
| –£—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏ | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | server/routes.ts |
| Timeout –Ω–∞ fonts | üü° –°—Ä–µ–¥–Ω–µ | ‚úÖ –£–∂–µ –±—ã–ª –∏—Å–ø—Ä–∞–≤–ª–µ–Ω | playwright-layout-collector.ts |
| Browserslist —É—Å—Ç–∞—Ä–µ–ª | üü¢ –ù–∏–∑–∫–æ | ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ | CLI –∫–æ–º–∞–Ω–¥–∞ |

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:** –î–æ–±–∞–≤—å—Ç–µ `npx playwright install firefox` –≤ Dockerfile/CI pipeline
2. **–î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:** –î–æ–±–∞–≤—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–∞–º—è—Ç–∏ —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —É—Ç–µ—á–∫–∏
3. **–î–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:** –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ singleton –±—Ä–∞—É–∑–µ—Ä –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:** 04 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è Playwright:** 1.56.1  
**–í–µ—Ä—Å–∏—è Firefox:** 142.0.1 (build 1495)
